<%- include('layout-start') %>

<div class="admin-section">
    <div class="admin-section-header">
        <h2>Tərəfdaşlar</h2>
        <button class="btn btn-primary btn-sm" onclick="document.getElementById('addPartnerModal').classList.add('open')">+ Yeni Tərəfdaş</button>
    </div>

    <div class="admin-table-wrapper">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Sıra</th>
                    <th>Logo</th>
                    <th>Ad</th>
                    <th>Təsvir</th>
                    <th>Status</th>
                    <th>Əməliyyatlar</th>
                </tr>
            </thead>
            <tbody>
                <% partners.forEach(function(p) { %>
                <tr>
                    <td><%= p.order %></td>
                    <td><% if (p.logo) { %><img src="<%= p.logo %>" style="height:32px"><% } else { %>—<% } %></td>
                    <td><strong><%= p.name %></strong></td>
                    <td class="text-muted"><%= p.description.substring(0, 50) %>...</td>
                    <td><span class="badge <%= p.active ? 'badge-green' : 'badge-red' %>"><%= p.active ? 'Aktiv' : 'Deaktiv' %></span></td>
                    <td class="table-actions">
                        <button class="btn btn-sm btn-outline" onclick='editPartner(<%- JSON.stringify(p.id) %>, <%- JSON.stringify(p.name) %>, <%- JSON.stringify(p.description) %>, <%- JSON.stringify(p.website || "") %>, <%= p.order %>, <%= p.active %>)'>Redaktə</button>
                        <form action="/admin/partners/delete/<%= p.id %>" method="POST" style="display:inline" onsubmit="return confirm('Silmək istədiyinizdən əminsiniz?')">
                            <button type="submit" class="btn btn-sm btn-danger">Sil</button>
                        </form>
                    </td>
                </tr>
                <% }); %>
            </tbody>
        </table>
    </div>
</div>

<!-- Add Modal -->
<div class="modal" id="addPartnerModal">
    <div class="modal-overlay" onclick="this.parentElement.classList.remove('open')"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Yeni Tərəfdaş Əlavə Et</h3>
            <button class="modal-close" onclick="this.closest('.modal').classList.remove('open')">&times;</button>
        </div>
        <form action="/admin/partners/add" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label>Ad</label>
                <input type="text" name="name" required>
            </div>
            <div class="form-group">
                <label>Təsvir</label>
                <textarea name="description" rows="2" required></textarea>
            </div>
            <div class="form-group">
                <label>Logo (şəkil)</label>
                <input type="file" name="logo" accept="image/*">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Veb sayt</label>
                    <input type="url" name="website" placeholder="https://">
                </div>
                <div class="form-group">
                    <label>Sıra</label>
                    <input type="number" name="order" value="<%= partners.length + 1 %>">
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Əlavə Et</button>
        </form>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal" id="editPartnerModal">
    <div class="modal-overlay" onclick="this.parentElement.classList.remove('open')"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Tərəfdaşı Redaktə Et</h3>
            <button class="modal-close" onclick="this.closest('.modal').classList.remove('open')">&times;</button>
        </div>
        <form id="editPartnerForm" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label>Ad</label>
                <input type="text" name="name" id="editPName" required>
            </div>
            <div class="form-group">
                <label>Təsvir</label>
                <textarea name="description" id="editPDesc" rows="2" required></textarea>
            </div>
            <div class="form-group">
                <label>Yeni Logo (dəyişdirmək istəmirsinizsə boş buraxın)</label>
                <input type="file" name="logo" accept="image/*">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Veb sayt</label>
                    <input type="url" name="website" id="editPWebsite" placeholder="https://">
                </div>
                <div class="form-group">
                    <label>Sıra</label>
                    <input type="number" name="order" id="editPOrder">
                </div>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="active" id="editPActive">
                    Aktiv
                </label>
            </div>
            <button type="submit" class="btn btn-primary">Yadda Saxla</button>
        </form>
    </div>
</div>

<script>
function editPartner(id, name, desc, website, order, active) {
    document.getElementById('editPartnerForm').action = '/admin/partners/edit/' + id;
    document.getElementById('editPName').value = name;
    document.getElementById('editPDesc').value = desc;
    document.getElementById('editPWebsite').value = website;
    document.getElementById('editPOrder').value = order;
    document.getElementById('editPActive').checked = active;
    document.getElementById('editPartnerModal').classList.add('open');
}
</script>

<%- include('layout-end') %>
