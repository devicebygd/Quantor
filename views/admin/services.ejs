<%- include('layout-start') %>

<div class="admin-section">
    <div class="admin-section-header">
        <h2>Xidmətlər</h2>
        <button class="btn btn-primary btn-sm" onclick="document.getElementById('addServiceModal').classList.add('open')">+ Yeni Xidmət</button>
    </div>

    <div class="admin-table-wrapper">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Sıra</th>
                    <th>Başlıq</th>
                    <th>Qısa Təsvir</th>
                    <th>İkon</th>
                    <th>Status</th>
                    <th>Əməliyyatlar</th>
                </tr>
            </thead>
            <tbody>
                <% services.forEach(function(s) { %>
                <tr>
                    <td><%= s.order %></td>
                    <td><strong><%= s.title %></strong></td>
                    <td class="text-muted"><%= s.shortDesc.substring(0, 60) %>...</td>
                    <td><%= s.icon %></td>
                    <td><span class="badge <%= s.active ? 'badge-green' : 'badge-red' %>"><%= s.active ? 'Aktiv' : 'Deaktiv' %></span></td>
                    <td class="table-actions">
                        <button class="btn btn-sm btn-outline" onclick='editService(<%- JSON.stringify(s.id) %>, <%- JSON.stringify(s.title) %>, <%- JSON.stringify(s.shortDesc) %>, <%- JSON.stringify(s.fullDesc) %>, <%- JSON.stringify(s.icon) %>, <%= s.order %>, <%= s.active %>)'>Redaktə</button>
                        <form action="/admin/services/delete/<%= s.id %>" method="POST" style="display:inline" onsubmit="return confirm('Silmək istədiyinizdən əminsiniz?')">
                            <button type="submit" class="btn btn-sm btn-danger">Sil</button>
                        </form>
                    </td>
                </tr>
                <% }); %>
            </tbody>
        </table>
    </div>
</div>

<!-- Add Modal -->
<div class="modal" id="addServiceModal">
    <div class="modal-overlay" onclick="this.parentElement.classList.remove('open')"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Yeni Xidmət Əlavə Et</h3>
            <button class="modal-close" onclick="this.closest('.modal').classList.remove('open')">&times;</button>
        </div>
        <form action="/admin/services/add" method="POST">
            <div class="form-group">
                <label>Başlıq</label>
                <input type="text" name="title" required>
            </div>
            <div class="form-group">
                <label>Qısa Təsvir</label>
                <textarea name="shortDesc" rows="2" required></textarea>
            </div>
            <div class="form-group">
                <label>Tam Təsvir</label>
                <textarea name="fullDesc" rows="4" required></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>İkon (license, server, network, cable, audit, automation, inventory, ticket, datacenter, cloud, security, support)</label>
                    <input type="text" name="icon" value="default">
                </div>
                <div class="form-group">
                    <label>Sıra</label>
                    <input type="number" name="order" value="<%= services.length + 1 %>">
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Əlavə Et</button>
        </form>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal" id="editServiceModal">
    <div class="modal-overlay" onclick="this.parentElement.classList.remove('open')"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Xidməti Redaktə Et</h3>
            <button class="modal-close" onclick="this.closest('.modal').classList.remove('open')">&times;</button>
        </div>
        <form id="editServiceForm" method="POST">
            <div class="form-group">
                <label>Başlıq</label>
                <input type="text" name="title" id="editTitle" required>
            </div>
            <div class="form-group">
                <label>Qısa Təsvir</label>
                <textarea name="shortDesc" id="editShortDesc" rows="2" required></textarea>
            </div>
            <div class="form-group">
                <label>Tam Təsvir</label>
                <textarea name="fullDesc" id="editFullDesc" rows="4" required></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>İkon</label>
                    <input type="text" name="icon" id="editIcon">
                </div>
                <div class="form-group">
                    <label>Sıra</label>
                    <input type="number" name="order" id="editOrder">
                </div>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="active" id="editActive">
                    Aktiv
                </label>
            </div>
            <button type="submit" class="btn btn-primary">Yadda Saxla</button>
        </form>
    </div>
</div>

<script>
function editService(id, title, shortDesc, fullDesc, icon, order, active) {
    document.getElementById('editServiceForm').action = '/admin/services/edit/' + id;
    document.getElementById('editTitle').value = title;
    document.getElementById('editShortDesc').value = shortDesc;
    document.getElementById('editFullDesc').value = fullDesc;
    document.getElementById('editIcon').value = icon;
    document.getElementById('editOrder').value = order;
    document.getElementById('editActive').checked = active;
    document.getElementById('editServiceModal').classList.add('open');
}
</script>

<%- include('layout-end') %>
